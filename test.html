<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
		<title>Активные задачи</title>
		<style type="text/css">
			body{box-sizing:border-box;font-size:10pt;line-height:10px;color:#000;font-family:monospace;text-align:left;}
			select{border:1px #0074CA solid;}
			input[type="text"]{}
			button[type="button"]{/*width:30px;*/height:20px;}
				.header{}
					.counter{}
				.tasks-list{display:flex;/*flex-direction:column;*/flex-flow:row wrap;}
					.task{/*width:100%;*/width:300px;height:fit-content;display:grid;grid-template-columns:repeat(5,20%);border:2px solid #0074CA;margin:2px;}
					.task>*{margin:3px 1px 1px 1px;}
					.task-id{grid-area:1/1/1/3;font-family:math;}
					.task-time{grid-area:1/3/1/6;text-align:right;font-family:math;}
					.task-address{grid-area:2/1/2/6;}
					.task-descr{grid-area:3/1/3/6;font-family:math;}
					.task-action-counters{grid-area:4/1/4/6;font-family:math;display:none;}
					.task-login{grid-area:5/1/5/3;}
					.task-state{grid-area:5/3/5/5;}
					.task-save{grid-area:5/5/5/6;}
					.task-reason{grid-area:6/1/6/6;}
		</style>
	</head>
	<body>
		<h2 class="header">Активные задачи:<span class="counter"></span></h2>
		<div class="tasks-list"></div>
		<script>
			fetch('https://script.google.com/macros/s/AKfycbwIPhtGGK5M-2TmJDRZvkkdPTq-WZwQ3RLIWEOEhlE61T8SDiZG6CWiMQ/exec?action=getTaskList&key=task_id').then(response=>response.json()).then(function(obj){
				for(let taskObj of obj.task_list.filter(function(item){return item.task_state=='new'||item.task_state=='start'})){/*только активные*/
					document.getElementsByClassName('tasks-list')[0].insertAdjacentHTML('afterBegin',`
						<div class="task">
							<div class="task-id">`+taskObj.task_id+`</div><div class="task-time">`+(new Date(taskObj.date_time).toLocaleString())+`</div>
							<div class="task-address">`+taskObj.site_name+` `+taskObj.address+`</div>
							<div class="task-descr">`+taskObj.description+`</div>
							<div class="task-action-counters">объекты: создать:[`+taskObj.num_create+`],&nbsp;править:[`+taskObj.num_update+`],&nbsp;удалить:[`+taskObj.num_delete+`];</div>
							<select class="task-login"><option `+((taskObj.login_tech=='')?'selected':'')+` disabled>&nbsp;</option><option value="nyblino1" `+((taskObj.login_tech=='nyblino1')?'selected':'')+`>nyblino1</option><option value="avfrants" `+((taskObj.login_tech=='avfrants')?'selected':'')+`>avfrants</option><option value="mvdenis1" `+((taskObj.login_tech=='mvdenis1')?'selected':'')+`>mvdenis1</option><option value="mypanty1" `+((taskObj.login_tech=='mypanty1')?'selected':'')+`>mypanty1</option></select>
							<select class="task-state"><option value="new" `+((taskObj.task_state=='new')?'selected':'')+`>новый</option><option value="start" `+((taskObj.task_state=='start')?'selected':'')+`>в работе</option><option value="reject">отклонил</option><option value="end">сделал</option></select>
							<button class="task-save" type="button">save</button>
							<input class="task-reason" type="text" value="`+taskObj.reason+`" placeholder="решение">
						</div>
					`);
				};
				document.getElementsByClassName('counter')[0].insertAdjacentHTML('beforeEnd',document.getElementsByClassName('task').length);
			});
		</script>
	</body>
</html>
